#!/usr/bin/env bash

bin=$$(dirname $0)
bin=$$(cd "$$bin"; pwd)

. "$$bin"/${project-name}-config.sh

gconf="$$${PROJECT_NAME}_CONF_DIR"/gunicorn.py

echo "stop ${project_name}"

target_pid=$$("$$PYTHON" "$$bin"/cat_pid.py "$$gconf")

if kill -0 $$target_pid > /dev/null 2>&1; then
    echo "kill $$target_pid"
    kill $$target_pid
    sleep 3
    if kill -0 $$target_pid > /dev/null 2>&1; then
        echo "${project_name} did not stop gracefully after 3 seconds"
    else
        echo "${project_name} stopped"
    fi
else
    echo "no ${project_name} to stop"
fi